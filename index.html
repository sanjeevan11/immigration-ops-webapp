<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Immigration Case Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1 { color: #1f77b4; margin-bottom: 30px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .stat-card h3 { font-size: 2em; color: #1f77b4; margin-bottom: 5px; }
        .stat-card p { color: #666; font-size: 0.9em; }
        .cases { display: grid; gap: 20px; }
        .case-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .case-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0; }
        .case-header h3 { color: #1f77b4; }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 0.85em; font-weight: 600; }
        .badge.urgent { background: #ffebee; color: #d32f2f; }
        .badge.normal { background: #e8f5e9; color: #388e3c; }
        .case-info { display: grid; gap: 8px; }
        .info-row { display: flex; justify-content: space-between; font-size: 0.9em; }
        .info-row .label { color: #666; font-weight: 500; }
        .loading { text-align: center; padding: 40px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #1f77b4; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
        .btn-primary { background: #1f77b4; color: white; }
        .btn-primary:hover { background: #1565c0; }
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìäUK Immigration Case Dashboard</h1>
        
        <div class="stats">
            <div class="stat-card">
                <h3 id="total-cases">0</h3>
                <p>Total Cases</p>
            </div>
            <div class="stat-card">
                <h3 id="urgent-cases">0</h3>
                <p>Urgent</p>
            </div>
            <div class="stat-card">
                <h3 id="pending-cases">0</h3>
                <p>Pending</p>
            </div>
            <div class="stat-card">
                <h3 id="new-cases">0</h3>
                <p>New</p>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>Recent Cases</h2>
            <button class="btn btn-primary" onclick="loadCases()">üîÑ Refresh</button>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading cases from Google Sheets...</p>
        </div>

        <div id="cases-list" class="cases"></div>
    </div>

    <script>
        const CONFIG = {
            SHEET_ID: '1qobSLoixuJILlkSP-nIo4qOHzVOLMpWv',
            API_KEY: 'YOUR_API_KEY_HERE',  // UPDATE THIS!
            SHEET_NAME: 'Cases'
        };

        async function loadCases() {
            const loading = document.getElementById('loading');
            const casesList = document.getElementById('cases-list');
            
            loading.style.display = 'block';
            casesList.innerHTML = '';

            try {
                const range = `${CONFIG.SHEET_NAME}!A:O`;
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/${range}?key=${CONFIG.API_KEY}`;
                
                const response = await fetch(url);
                const data = await response.json();

                if (!data.values || data.values.length === 0) {
                    casesList.innerHTML = '<div class="empty-state"><p style="font-size: 3em;">üìé</p><h3>No cases found</h3><p>Cases from your WhatsApp bot will appear here automatically.</p></div>';
                    loading.style.display = 'none';
                    return;
                }

                const headers = data.values[0];
                const rows = data.values.slice(1);
                const cases = rows.map(row => {
                    const caseObj = {};
                    headers.forEach((header, index) => {
                        caseObj[header] = row[index] || '';
                    });
                    return caseObj;
                }).filter(c => c['Case ID']);

                // Update stats
                document.getElementById('total-cases').textContent = cases.length;
                document.getElementById('urgent-cases').textContent = cases.filter(c => c['Urgency'] === 'Urgent').length;
                document.getElementById('pending-cases').textContent = cases.filter(c => c['Status'] && c['Status'].includes('Pending')).length;
                document.getElementById('new-cases').textContent = cases.filter(c => c['Status'] === 'New' || !c['Status']).length;

                // Display cases
                casesList.innerHTML = cases.map(c => `
                    <div class="case-card">
                        <div class="case-header">
                            <div>
                                <h3>${c['Name'] || 'N/A'}</h3>
                                <small style="color: #999;">${c['Case ID'] || 'N/A'}</small>
                            </div>
                            <span class="badge ${c['Urgency'] === 'Urgent' ? 'urgent' : 'normal'}">${c['Urgency'] || 'Normal'}</span>
                        </div>
                        <div class="case-info">
                            <div class="info-row"><span class="label">üìß Email:</span><span>${c['Email'] || 'N/A'}</span></div>
                            <div class="info-row"><span class="label">üìû Phone:</span><span>${c['Phone'] || 'N/A'}</span></div>
                            <div class="info-row"><span class="label">üõú Visa Route:</span><span>${c['Visa Route'] || 'N/A'}</span></div>
                            <div class="info-row"><span class="label">üìã Status:</span><span>${c['Status'] || 'New'}</span></div>
                            <div class="info-row"><span class="label">üìÖ Date:</span><span>${c['Date Submitted'] || 'N/A'}</span></div>
                        </div>
                        ${c['Drive Folder Link'] ? `<div style="margin-top: 15px;"><a href="${c['Drive Folder Link']}" target="_blank" class="btn btn-primary">üìÅ Open Folder</a></div>` : ''}
                    </div>
                `).join('');

                loading.style.display = 'none';
            } catch (error) {
                console.error('Error loading cases:', error);
                casesList.innerHTML = '<div class="empty-state"><p style="font-size: 3em; color: #d32f2f;">‚ùå</p><h3>Error loading data</h3><p>Please check your API key and Sheet ID configuration.</p></div>';
                loading.style.display = 'none';
            }
        }

        // Auto-refresh every 10 seconds
        setInterval(loadCases, 10000);
        
        // Load on page load
        loadCases();
    </script>
</body>
</html>
